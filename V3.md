# Arquitectura del Sistema OCR

## Diagrama de Fases

```mermaid
flowchart TB
    subgraph MAIN["🎯 MÓDULO PRINCIPAL"]
        M1[main] --> M2[verificar_dependencias]
        M2 --> M3{MODO_LOCAL?}
    end
    
    subgraph INPUT["📥 MÓDULO ENTRADA"]
        I1[procesar_archivo_local]
        I2[leer_cola_auditorias]
        I3[leer_contenido_blob]
    end
    
    subgraph OCR["🔍 MÓDULO OCR"]
        O1[extraer_texto_pdfplumber]
        O2[extraer_texto_ocr_por_hoja]
        O3[ocr_batch_gpu]
        O4[ocr_hibrido_una_pagina]
        O5[_extraer_con_easyocr]
        O6[_extraer_con_tesseract]
        O7[_seleccionar_mejor_ocr]
    end
    
    subgraph IMAGE["🖼️ MÓDULO IMAGEN"]
        IMG1[preprocesar_imagen_con_deskew]
        IMG2[corregir_inclinacion]
        IMG3[encontrar_angulo_skew]
        IMG4[rotar_imagen]
        IMG5[preprocesar_imagen]
    end
    
    subgraph CLASSIFY["🏷️ MÓDULO CLASIFICACIÓN"]
        C1[clasificar_paginas_por_tipo]
        C2[procesar_subdocumento]
    end
    
    subgraph AI["🤖 MÓDULO IA"]
        A1[qa_pipeline]
        A2[limpiar_contexto]
        A3[corregir_caracteres_malformados]
        A4[obtener_respuesta_openai]
        A5[limpiar_respuesta_modelo]
    end
    
    subgraph DB["💾 MÓDULO BASE DE DATOS"]
        D1[convertir_resultados_a_dataframe]
        D2[limpiar_fechas]
        D3[consultar_radicado_iq]
        D4[WriteSQL]
    end
    
    subgraph OUTPUT["📤 MÓDULO SALIDA"]
        OUT1[enviar_identificaciones_servicebus]
        OUT2[Limpieza archivos locales]
    end
    
    %% FLUJO PRINCIPAL
    M3 -->|Local| I1
    M3 -->|MV| I2
    I2 --> I3
    I1 --> O1
    I3 --> O1
    O1 --> O2
    O2 --> O3
    O2 --> O4
    O3 --> IMG1
    O4 --> IMG1
    IMG1 --> IMG2
    IMG2 --> IMG3
    IMG3 --> IMG4
    IMG4 --> IMG5
    IMG5 --> O5
    IMG5 --> O6
    O5 --> O7
    O6 --> O7
    O7 --> C1
    C1 --> C2
    C2 --> A1
    A1 --> A2
    A2 --> A3
    A3 --> A4
    A4 --> A5
    A5 --> D1
    D1 --> D2
    D2 --> D3
    D3 --> D4
    D4 --> OUT1
    D4 --> OUT2
```

## Explicación del Proceso

### 🚀 Fase 1: Arranque
- Configuración inicial del sistema
- Verificación de herramientas (Tesseract, GPU, etc.)
- Decisión de modo de operación

### 📥 Fase 2: Obtener Archivo  
- **Local**: Lee archivo del sistema de archivos
- **Nube**: Descarga desde Azure Blob Storage

[... más explicaciones]
